<div class="admin-layout-flex">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="sidebar-title">
      <i class="bi bi-shop-window"></i>
      <span>Admin</span>
    </div>
    <nav class="sidebar-nav">
      <button class="sidebar-link" [class.active]="activeTab === 'dashboard'" (click)="activeTab = 'dashboard'">
        <i class="bi bi-speedometer2"></i> Dashboard
      </button>
      <button class="sidebar-link" [class.active]="activeTab === 'products'" (click)="activeTab = 'products'">
        <i class="bi bi-box"></i> Products
      </button>
      <button class="sidebar-link" [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">
        <i class="bi bi-list-ul"></i> Orders
      </button>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <div class="admin-main">
    <!-- Topbar -->
    <header class="admin-topbar">
      <div class="topbar-title">
        <i class="bi bi-gear-fill"></i> Admin Dashboard
      </div>
      <div class="topbar-actions">
        <div class="admin-avatar">
          <i class="bi bi-person-circle"></i>
        </div>
        <button class="btn btn-outline-danger" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i> Logout
        </button>
      </div>
    </header>

    <!-- Main Content Wrapper: giữ cố định chiều rộng cho mọi tab -->
    <div class="admin-main-content">
      <!-- Statistics Cards (Dashboard only) -->
      <div class="stats-section" *ngIf="activeTab === 'dashboard'">
        <div class="stats-cards-row">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="bi bi-box"></i>
            </div>
            <div class="stat-content">
              <h3>{{ stats.totalProducts }}</h3>
              <p>Total Products</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="bi bi-cart"></i>
            </div>
            <div class="stat-content">
              <h3>{{ stats.totalOrders }}</h3>
              <p>Total Orders</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="stat-content">
              <h3>${{ stats.totalRevenue.toFixed(2) }}</h3>
              <p>Total Revenue</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="bi bi-clock"></i>
            </div>
            <div class="stat-content">
              <h3>{{ stats.pendingOrders }}</h3>
              <p>Pending Orders</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Dashboard Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'dashboard'">
          <div class="dashboard-content">
            <div class="row">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header">
                    <h5><i class="bi bi-box me-2"></i>Recent Products</h5>
                  </div>
                  <div class="card-body">
                    <div class="recent-products">
                      <div class="product-item" *ngFor="let product of products.slice(0, 5)">
                        <img [src]="product.imageUrl || 'assets/placeholder-product.jpg'" [alt]="product.name">
                        <div class="product-info">
                          <h6>{{ product.name }}</h6>
                          <p class="text-muted">${{ product.price }}</p>
                        </div>
                        <span class="badge" [class.bg-success]="product.active" [class.bg-secondary]="!product.active">
                          {{ product.active ? 'Active' : 'Inactive' }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header">
                    <h5><i class="bi bi-cart me-2"></i>Recent Orders</h5>
                  </div>
                  <div class="card-body">
                    <div class="recent-orders">
                      <div class="order-item" *ngFor="let order of orders.slice(0, 5)">
                        <div class="order-info">
                          <h6>Order #{{ order.id }}</h6>
                          <p class="text-muted">{{ order.customerName || 'Customer' }}</p>
                        </div>
                        <div class="order-amount">
                          <strong>${{ order.totalAmount }}</strong>
                          <span class="badge ms-2" [class.bg-warning]="order.status === 'PENDING'" 
                                [class.bg-success]="order.status === 'DELIVERED'"
                                [class.bg-info]="order.status === 'SHIPPED'">
                            {{ order.status }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Products Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'products'">
          <div class="products-content">
            <div class="card">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h5><i class="bi bi-box me-2"></i>Product Management</h5>
                  <div class="d-flex gap-2">
                    <div class="input-group" style="max-width: 300px;">
                      <input 
                        type="text" 
                        class="form-control" 
                        placeholder="Search products..."
                        [(ngModel)]="productSearchTerm"
                        (input)="onProductSearch()"
                      >
                      <button class="btn btn-outline-secondary">
                        <i class="bi bi-search"></i>
                      </button>
                    </div>
                    <button class="btn btn-primary" (click)="exportProducts()">
                      <i class="bi bi-download me-1"></i>Export
                    </button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <!-- Loading State -->
                <div class="text-center py-5" *ngIf="isLoadingProducts">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mt-3 text-muted">Loading products...</p>
                </div>

                <!-- Products Table -->
                <div class="table-responsive" *ngIf="!isLoadingProducts">
                  <table class="table table-hover">
                    <thead class="table-light">
                      <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let product of filteredProducts">
                        <td>
                          <img 
                            [src]="product.imageUrl || 'assets/placeholder-product.jpg'" 
                            class="rounded" 
                            [alt]="product.name"
                            style="width: 50px; height: 50px; object-fit: cover;"
                          >
                        </td>
                        <td>
                          <div>
                            <strong>{{ product.name }}</strong>
                            <br>
                            <small class="text-muted">{{ product.description | slice:0:50 }}...</small>
                          </div>
                        </td>
                        <td>
                          <span class="badge bg-secondary">{{ product.category }}</span>
                        </td>
                        <td>
                          <strong class="text-primary">${{ product.price }}</strong>
                        </td>
                        <td>
                          <span class="badge" [class.bg-success]="product.stockQuantity > 10" 
                                [class.bg-warning]="product.stockQuantity <= 10 && product.stockQuantity > 0" 
                                [class.bg-danger]="product.stockQuantity === 0">
                            {{ product.stockQuantity }}
                          </span>
                        </td>
                        <td>
                          <div class="form-check form-switch">
                            <input 
                              class="form-check-input" 
                              type="checkbox" 
                              [checked]="product.active"
                              (change)="toggleProductStatus(product)"
                            >
                            <label class="form-check-label">
                              {{ product.active ? 'Active' : 'Inactive' }}
                            </label>
                          </div>
                        </td>
                        <td>
                          <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" title="Edit">
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-info" title="View">
                              <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-outline-danger" title="Delete" (click)="deleteProduct(product)">
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Empty State -->
                <div class="text-center py-5" *ngIf="!isLoadingProducts && filteredProducts.length === 0">
                  <i class="bi bi-box display-1 text-muted"></i>
                  <h4 class="mt-3 text-muted">No products found</h4>
                  <p class="text-muted">Start by adding your first product!</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Orders Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'orders'">
          <div class="orders-content">
            <div class="card">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h5><i class="bi bi-list-ul me-2"></i>Order Management</h5>
                  <div class="input-group" style="max-width: 300px;">
                    <input 
                      type="text" 
                      class="form-control" 
                      placeholder="Search orders..."
                      [(ngModel)]="orderSearchTerm"
                      (input)="onOrderSearch()"
                    >
                    <button class="btn btn-outline-secondary">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <!-- Loading State -->
                <div class="text-center py-5" *ngIf="isLoadingOrders">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mt-3 text-muted">Loading orders...</p>
                </div>

                <!-- Orders Table -->
                <div class="table-responsive" *ngIf="!isLoadingOrders">
                  <table class="table table-hover">
                    <thead class="table-light">
                      <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let order of filteredOrders">
                        <td>
                          <strong>#{{ order.id }}</strong>
                        </td>
                        <td>
                          <div>
                            <strong>{{ order.customerName || 'Customer' }}</strong>
                            <br>
                            <small class="text-muted">{{ order.customerEmail || 'No email' }}</small>
                          </div>
                        </td>
                        <td>
                          <span class="badge bg-info">{{ order.items.length }} items</span>
                        </td>
                        <td>
                          <strong class="text-success">${{ order.totalAmount }}</strong>
                        </td>
                        <td>
                          <select class="form-select form-select-sm" 
                                  [value]="order.status"
                                  (change)="onOrderStatusChange(order, $event)">
                            <option value="PENDING">Pending</option>
                            <option value="CONFIRMED">Confirmed</option>
                            <option value="SHIPPED">Shipped</option>
                            <option value="DELIVERED">Delivered</option>
                            <option value="CANCELLED">Cancelled</option>
                          </select>
                        </td>
                        <td>
                          <small class="text-muted">{{ order.createdAt | date:'short' }}</small>
                        </td>
                        <td>
                          <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-info" title="View Details">
                              <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-outline-primary" title="Print">
                              <i class="bi bi-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Empty State -->
                <div class="text-center py-5" *ngIf="!isLoadingOrders && filteredOrders.length === 0">
                  <i class="bi bi-list-ul display-1 text-muted"></i>
                  <h4 class="mt-3 text-muted">No orders found</h4>
                  <p class="text-muted">Orders will appear here when customers place them.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Template giữ nguyên phần cũ để không lặp code -->
      <ng-template #productsTab>
        <!-- ... nguyên phần quản lý sản phẩm ... -->
        <!-- Copy/paste phần cũ vào đây nếu cần -->
      </ng-template>
      <ng-template #ordersTab>
        <!-- ... nguyên phần quản lý đơn hàng ... -->
        <!-- Copy/paste phần cũ vào đây nếu cần -->
      </ng-template>
    </div>
  </div>
</div> 